name: tests

on: [pull_request, push, repository_dispatch]

jobs:
  test:
    runs-on: macos-latest

    steps:
    - name: checkout repository
      uses: actions/checkout@v3

    - name: install dependencies
      run: |
        ci-tests/install-dependencies.sh

    - name: build
      run: |
        CXX=gcc-13 cmake .
        touch default-settings.o
        make -j $(getconf _NPROCESSORS_ONLN)

    - name: run functional test
      run: ci-tests/full_test.py
